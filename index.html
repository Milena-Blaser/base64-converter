<script>
  async function uploadImage() {
    const input = document.getElementById('imageInput');
    const file = input.files[0];
    if (!file) {
      alert("Please select an image");
      return;
    }

    // Convert to Base64 for sending back
    const toBase64 = file => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result); // includes data:image/jpeg;base64,...
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    const base64Image = await toBase64(file);

    const formData = new FormData();
    formData.append('file', file);

    try {
      const response = await fetch('https://ocr-extract-text.p.rapidapi.com/ocr/file', {
        method: 'POST',
        headers: {
          'X-RapidAPI-Key': '11083d3e5emsh163c76e8056d4a5p1d3e0cjsnba8f2be5464a',
          'X-RapidAPI-Host': 'ocr-extract-text.p.rapidapi.com'
        },
        body: formData
      });

      const result = await response.json();
      const extractedText = result.text || "No text found.";

      // âœ… Send both image and text as a JSON string
      const payload = {
        image: base64Image,
        text: extractedText
      };

      window.ReactNativeWebView?.postMessage(JSON.stringify(payload));
    } catch (err) {
      window.ReactNativeWebView?.postMessage(JSON.stringify({
        error: err.message
      }));
    }
  }
</script>
